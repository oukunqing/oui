<!DOCTYPE html>
<html>
<head>
	<meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
	<title>网格地图</title>
    <style type="text/css">
        button {height:26px;min-width: 26px;line-height: 24px;float:left;margin:0 5px 0 0;}
        input {height: 26px; border:solid 1px #ccc; border-radius: 4px; box-sizing: border-box;float:left;margin:0 5px 0 0;}
    </style>
</head>
<body>
    <div style="clear: both;overflow: hidden;">
        <button onclick="setLevel(1);">+</button>
        <button onclick="setLevel(-1);">-</button>
        <input type="text" id="txtLevel" />
        <button onclick="setLevel(0);">缩放</button>
        <button onclick="setCenter();">中心</button>
        <button onclick="setOverview();">全览</button>
        <button onclick="setTest();">测试</button>
    </div>
    <div id="box1" style="width:70%;height:500px;border:solid 1px #f00;clear:both;margin-top:5px;">
        <canvas id="gridCanvas" width="800" height="500"></canvas>
    </div>
    <div style="width:70%;height:500px;border:solid 1px #f00;margin:50px 0 200px;">
        <canvas id="gridCanvas2"></canvas>
    </div>
</body>
</html>
<script type="text/javascript" src="../oui/oui.js?1"></script>
<script type="text/javascript" src="../oui/gmap/oui.gmap.js"></script>
<script type="text/javascript">
window.onload = function() {
    showScaleMap();
    showVerticalMap();
};

function showScaleMap() {
    var points = [{
            id: 'C2-9364',
            name: 'C2-9364', color: '#00f',
            radius: 6,
            latitude: 26.8732976498,
            longitude: 122.6011577513,
            height: 124.123,
            textStyle: { font:'14px Arial',color:'#f00',position: 4 },
            //lines: ['C1-9123','B2-9527'],
            lines: [{id:'C1-9123',color:'#f00',width:1},{id:'B2-9527',color:'#000',width:1, dash:[2,4]}],
            texts: [{text:'C2-9364',position:3,color:'#00f'}],
            distances: [{id:'B2-9527'}],
            lineStyle: {width:1, color: '#00f', dash: false}
        },{
            id: 'C1-9123',
            name: 'C1-9123', color: '#f00',
            latitude: 29.8732976498,
            longitude: 125.6011577513,
            height: 124.123,
            lines: ['B1-2345'],
            lineStyle: {width:1, color: '#00f', dash: [2,4]},
            polygon: 'C2-9364',
            polygonStyle: {width:1,color:'#f00',dash:[2,4]},
            distances: 'B1-2345',
            /*distanceStyle: {
                // 距离文字的位置：0 - 起点， 1 - 终点， 2 - 中心点
                //position: 2,
                // 显示的最大距离，单位：米
                maxDistance: 100 * 1000 * 10,
                // 距离的默认单位是米，这里用厘米，所以倍率为100
                ratio: 100,
                // 单位和倍率是成对的，别搞错了
                unit: '厘米',
                decimal: 2,
                font:'20px Arial',color:'#00f'
            }*/
        },{
            id: 'B1-2345',
            name: 'B1-2345', color: '#000',
            textStyle: {position: 1, color: '#000' },
            latitude: 31.8732976498,
            longitude: 122.6011577513,
            height: 122.125,
            lines: [{id:'B2-9527', color: '#000'}],
            polygons: 'B2-9527',
            polygonStyle: {width:1,color:'#000',dash:[2,4]},
        },{
            id: 'B2-9527',
            name: 'B2-9527', color: '#000',
            textStyle: {position: 1, color: '#000' },
            latitude: 29.8732976498,
            longitude: 121.6011577513,
            height: 122.123,
        }
    ];

    let enable = true;
    
    if (enable) {
        $.gmap('gridCanvas', {
            title: '水平位置图',
            remark: '黑色表示下层结构',
            plane: true, 
            //minScaleLevel: 6,
            maxScaleLevel: 30,
            showOverview: true, autoOverview: false, showPosition: true, showRemark: true,
            showScale: true,  showHeight: false, showPolygon: true, showMousePosition: true,
            showScaleLevel: true, editableLevel: false,
            //这三个参数默认是启用的
            showLine: true, showText: true, showDistance: true,
            distanceStyle: {
                // 距离文字的位置：0 - 起点， 1 - 终点， 2 - 中心点
                position: 2,
                // 显示的最大距离，单位：米
                maxDistance: 100 * 1000 * 10,
                // 距离的默认单位是米，这里用厘米，所以倍率为100
                ratio: 100,
                // 单位和倍率是成对的，别搞错了
                unit: 'cm',
                decimal: 0,
                prefix: '距离:',
                font: '20px Arial', color: '#f00'
            },
            lineStyle: { width: 1, color: '#00f' },
            textStyle: { font: '14px Arial', color: '#f00', position: 3 },
            polygonStyle: {width:1,color:'#000',dash:[1,1]},
            points: points
        }).size().remark($.gmap.buildRemark({
            title:'颜色说明', colors:[{color:'#f00',text:'上层'},{color:'#000',text:'下层'},{color:'#00f',text:'距离'}]
        }));

        window.setTimeout(function() {
            $.gmap('gridCanvas').scale(60).center({latitude: 29.8732976498, longitude: 121.6011577513});
        }, 1000);

        window.setTimeout(function() {
            $.gmap('gridCanvas').overview(true);
        }, 2000);
    }
}

function showVerticalMap() {

    var points2 = [{
            id: 'C1-9123',
            name: 'C1-9123', color: '#f00',
            latitude: 31.8732976498,
            longitude: 122.6011877513,
            height: 124.123,
            //高度调节，用于上下位置补偿
            //adjustHeight: -0.5,
            lines: ['B1-2345'],
            distances: 'B1-2345',
            distanceStyle: {
                // 距离文字的位置：0 - 起点， 1 - 终点， 2 - 中心点
                position: 6,
                // 显示的最大距离，单位：米
                maxDistance: 100 * 1000 * 10,
                // 距离的默认单位是米，这里用厘米，所以倍率为100
                ratio: 100,
                // 单位和倍率是成对的，别搞错了
                unit: '厘米',
                decimal: 2,
                vertical: true,
                font:'20px Arial',color:'#00f'
            },
            lineStyle: {width:1, color: '#00f', dash: [2,4]}
        },{
            id: 'C2-9364',
            name: 'C2-9364', color: '#00f',
            radius: 6,
            latitude: 31.8732976498,
            longitude: 122.6011677513,
            height: 124.123,
            //高度调节，用于上下位置补偿
            //adjustHeight: -0.5,
            textStyle: { font:'14px Arial',color:'#f00',position: 4 },
            //lines: ['C1-9123','B2-9527'],
            lines: [{id:'C1-9123',color:'#f00',width:1},{id:'B2-9527',color:'#000',width:1, dash:[2,4],vertical:true}],
            texts: [{text:'C2-9364',position:3,color:'#00f'}],
            distances: [{id:'B2-9527'}],
            lineStyle: {width:1, color: '#00f', dash: false}
        },{
            id: 'B1-2345',
            name: 'B1-2345', color: '#000',
            textStyle: {position: 1, color: '#000' },
            latitude: 31.8732976498,
            longitude: 122.6011977513,
            height: 121.123,
            //高度调节，用于上下位置补偿
            //adjustHeight: 0.5,
            lines: [{id:'B2-9527', color: '#000'}]
        },{
            id: 'B2-9527',
            name: 'B2-9527', color: '#000',
            textStyle: {position: 1, color: '#000' },
            latitude: 31.8732976498,
            longitude: 122.6011577513,
            height: 121.123,
            //高度调节，用于上下位置补偿
            //adjustHeight: 0.5,
        }
    ];

    $.gmap('gridCanvas2', {
        title: '高度位置图',
        vertical:true,
        plane: true,
        scaleLevel: 20,
        showScale: true,
        showOverview: true,
        showPosition: true, showScale: true, 

        distanceStyle: {
            // 距离文字的位置：0 - 起点， 1 - 终点， 2 - 中心点，3 - 垂直线中间左边，6 - 垂直线中间右边
            position: 3,
            // 显示的最大距离，单位：米
            maxDistance: 100 * 1000 * 10,
            // 距离的默认单位是米，这里用厘米，所以倍率为100
            ratio: 100,
            // 单位和倍率是成对的，别搞错了
            unit: 'cm',
            decimal: 0,
            prefix: '高差:',
            vertical: true,
            hideDiagonal: true,
            //三角形模式: M - 上三角，W - 下三角, A - 自适应
            verticalMode: 'W',
            adjustPrefix: '补差:',
            font: '20px Arial', color: '#f00'
        },
    }).size().update(points2);
}

function setTest() {
    showVerticalMap();
}

function setLevel(action) {
    if (!action) {
        $.gmap('gridCanvas').scaleLevel($('#txtLevel').val().toInt());
    } else {
        $.gmap('gridCanvas').scaleLevel(null, action);
    }
}

function setCenter() {
    $.gmap('gridCanvas').center(true);
}
function setOverview() {
    $.gmap('gridCanvas').overview(true);
}

window.onresize = function() {

};
</script>