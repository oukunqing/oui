<!DOCTYPE html>
<html>
<head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>树形菜单</title>
    <style type="text/css">
        body {background:#fff;margin:0;padding:0;font-size: 14px;font-family: 宋体;}
        .form{background: #fff;overflow: hidden;width:1000px; padding:0}
        div{clear:both;overflow:hidden;}
        div.box {border:solid 1px #ccc;border-radius:4px;padding:8px 8px 0;margin:0 0 10px 0;}
        button{ height:30px;line-height:24px; padding:0 10px;font-family: 宋体;font-size:14px;
            display:inline-block;float:left;margin:0 8px 8px 0;}
        select {height:30px;border:solid 1px #ccc;border-radius: 4px;float:left;margin:0 8px 8px 0;}
        .chb-label {border:solid 1px #ccc;border-radius:4px;box-sizing:border-box;padding:5px 10px 0 2px;height:30px;
            display:inline-block;overflow:hidden;float:left;margin:0 8px 8px 0;}
        .chb-label input{float:left;}
        .chb-label span{line-height:18px;}
    </style>
    <script type="text/javascript" src="../oui/oui.js?1"></script>
    <script type="text/javascript" src="../oui/tree/oui.tree.js?123"></script>
</head>
<body>
<div class="form">
    <div style="float:left;padding:10px;clear:none;">
        <div id="otr" style="display:block;border:solid 1px #00f;border-radius:4px;overflow:auto;width:400px;height:800px;margin:0;"></div>
        <div id="txt" style="margin:0;padding: 10px 0;"></div>
    </div>
    <div style="float:left;padding:0;margin:10px 0 0;clear:none;">
        <div class="box">  
            <div>
                <label class="chb-label"><input type="checkbox" value="root" name="chbData" checked="checked" /><span>根节点</span></label>
                <label class="chb-label"><input type="checkbox" value="unit" name="chbData" checked="checked" /><span>目录</span></label>
                <label class="chb-label"><input type="checkbox" value="device" name="chbData" /><span>设备</span></label>
                <label class="chb-label"><input type="checkbox" value="camera" name="chbData" /><span>通道</span></label>
                <label class="chb-label"><input type="checkbox" value="department" name="chbData" /><span>部门</span></label>
                <label class="chb-label"><input type="checkbox" value="person" name="chbData" /><span>人员</span></label>
            </div>
            <div>
                <select id="ddlLevel">
                    <option value="-1">全部展开</option>
                    <option value="0">全部收缩</option>
                    <option value="1" selected="selected">展开到1级</option>
                    <option value="2">展开到2级</option>
                    <option value="3">展开到3级</option>
                    <option value="4">展开到4级</option>
                    <option value="5">展开到5级</option>
                    <option value="6">展开到6级</option>
                </select>
                <label class="chb-label"><input type="checkbox" id="chbCheck" checked="checked" /><span>显示选框</span></label>
                <label class="chb-label"><input type="checkbox" id="chbIcon" checked="checked" /><span>显示图标</span></label>
                <div>
                    <button onclick="test();">加载树菜单</button>
                    <button onclick="test(2);">加载树菜单2</button>
                </div>
            </div>
        </div>
        <div id="divOper" class="box" style="display:none;">
            <div>                
                <label class="chb-label">
                    <input type="checkbox" value="1" id="chbLinkage" checked="checked" />
                    <span>级联</span>
                </label>
            </div>
            <div>
                <select id="ddlLevel2" style="width:62px;">
                    <option value="0">0级</option>
                    <option value="1">1级</option>
                    <option value="2">2级</option>
                    <option value="3">3级</option>
                    <option value="4">4级</option>
                </select>
                <button onclick="expandLevel();">按层级展开</button>
                <button onclick="expandLevel(false);">按层级收缩</button>
                <button onclick="expandAll();">全部展开</button>
                <button onclick="expandAll(false);">全部收缩</button>
            </div>
            <div>
                <select id="ddlType2" style="width:62px;">
                    <option value="unit">目录</option>
                    <option value="device">设备</option>
                    <option value="camera">通道</option>
                    <option value="department">部门</option>
                    <option value="person">人员</option>
                </select>
                <button onclick="expandType();">按类型展开</button>
                <button onclick="expandType(false);">按类型收缩</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
<script type="text/javascript" src="dropdownlist.json"></script>
<script type="text/javascript">

    var data = {
        datas: [{id:0,name:'数据',type:'data'}],
        units: [
            {id:1,pid:0,name:'主控制中心',ptype:'data'},
            {id:2,pid:1,name:'中言科技'},
            {id:3,pid:1,name:'浙江'},
            {id:4,pid:1,name:'江苏'},
            {id:5,pid:2,name:'演示测试'},
            {id:6,pid:5,name:'演示测试1'},
            {id:7,pid:5,name:'演示测试2'},
            {id:8,pid:2,name:'出厂检测'},
            {id:9,pid:8,name:'出厂检测1'},
            {id:10,pid:8,name:'出厂检测2'}
        ]
    };

    window.onload = function () {

    };

    var TreeId = 'otr';

    function expandLevel(expand) {
        var linkage = $('#chbLinkage').checked(),
            level = $('#ddlLevel2').val().toInt();
        $.console.log('expandLevel:', level, linkage, expand);
        $.tree(TreeId).expandLevel(level, linkage, expand);
    }

    function expandType(expand) {
        var linkage = $('#chbLinkage').checked(),
            type = $('#ddlType2').val();
        $.tree(TreeId).expandType(type, linkage, expand);
    }

    function expandAll(expand) {
        $.tree(TreeId).expandAll(expand);
    }

    function test(type) {   
        var arr = $N('chbData'), keys = {};
        for (var i = 0; i < arr.length; i++) {
            if (arr[i].checked) {
                keys[arr[i].value] = 1;
            }
        }

        var trees = [
            keys['root'] ? {type:'root',key:'datas'} : undefined,
            keys['unit'] ? {type:'unit',key:'units'} : undefined,
            keys['device'] ? {type:'device',key:'devices',ptype:'unit'} : undefined,
            keys['camera'] ? {type:'camera',key:'cameras',ptype:'device'} : undefined,
            keys['department'] ? {type:'department',key:'departments'} : undefined,
            keys['person'] ? {type:'person',key:'persons',ptype:'department'} : undefined
        ];

        $.console.log('trees:', trees);

        var html = ['begin: ' + new Date().format('HHmmss.fff') + ', '],
            data = type ? treedata2 : treedata,
            level = $('#ddlLevel').val().toInt(),
            showCheck = $('#chbCheck').checked(),
            showIcon = $('#chbIcon').checked();

        data.units[0].desc = new Date().getTime();

        $.tree(TreeId, {
            skin: 'device', 
            //async: true, 
            debug: true,
            trees: trees,
            data: data,
            showCheck: showCheck,
            showIcon: showIcon,
            //leaf: true,
            //leafType: 'device',
            //dynamic: true,
            //dynamicType: 'device',
            //openLevel: 1,
            //openType: 'unit',
            openLevel: level,
            //dynamic: 3,
            checkbox: true,
            complete: function (tree) {
                $('#divOper').show();

                html.push('finish: ' + new Date().format('HHmmss.fff') + '<br />');
                //console.log('complete:', tree.id, tree.cache);
                $('#txt').html(html.concat([
                    'nodes:', tree.cache.count, ', level:', tree.cache.level, ', timeout:', tree.cache.timeout, 'ms'
                ]).join(''));
                /*
                window.setTimeout(function() {
                    tree.updateIcon('7280,7155', 'device', {status:'off'});
                    tree.icon(7151, 'device', {status:'off'});
                    $.tree(TreeId).updateIcon('7759', 'camera', {status:'play'});
                    $.tree.updateIcon(TreeId, '7760', 'camera', {status:'play'});
                    tree.text(7153, 'device', '204488设备');
                }, 10);
                window.setTimeout(function() {
                    tree.selected([826, 343, 780], 'unit', true)
                        .checked([826, 343], 'unit')
                        //.position(343, 'unit')
                        //.collapse(2, 'unit');
                }, 20);
                */
                //window.setTimeout(function() { tree.expandType('unit', true, true); }, 200);
                //window.setTimeout(function() { tree.collapseType('device', true); }, 20);

                //window.setTimeout(function() { $.tree.expandAll(TreeId); }, 20);
                //window.setTimeout(function() { tree.expandAll(); }, 20);
                //window.setTimeout(function() { tree.collapseAll(); }, 20);

                //window.setTimeout(function() { $.tree.expand(TreeId, 290, 'unit'); }, 20);
                //window.setTimeout(function() { tree.expand(190, 'unit'); }, 20);

                //window.setTimeout(function() { tree.expandLevel(2, true, true); }, 20);
            },
            expandCallback: function (node, tree) {
                $.console.log('expandCallback:', node, tree.id);
            }
        });
        $.console.log('test finish:');
    }
  
</script>